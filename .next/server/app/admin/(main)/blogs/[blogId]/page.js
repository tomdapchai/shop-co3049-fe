(()=>{var e={};e.id=5073,e.ids=[5073],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},83997:e=>{"use strict";e.exports=require("tty")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},18309:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=t(70260),a=t(28203),l=t(25155),i=t.n(l),n=t(67292),o={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(r,o);let c=["",{children:["admin",{children:["(main)",{children:["blogs",{children:["[blogId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,52603)),"W:\\web\\shop-co3049-fe\\app\\admin\\(main)\\blogs\\[blogId]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9540)),"W:\\web\\shop-co3049-fe\\app\\admin\\(main)\\layout.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,19611)),"W:\\web\\shop-co3049-fe\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["W:\\web\\shop-co3049-fe\\app\\admin\\(main)\\blogs\\[blogId]\\page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/admin/(main)/blogs/[blogId]/page",pathname:"/admin/blogs/[blogId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},15681:(e,r,t)=>{Promise.resolve().then(t.bind(t,52603))},52129:(e,r,t)=>{Promise.resolve().then(t.bind(t,25055))},25055:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>I});var s=t(45512),a=t(58009),l=t(79334),i=t(6868),n=t(81914),o=t(87021),c=t(48859),d=t(71965),u=t(666),p=t(70801),g=t(27071),h=t(94727),m=t(25409),x=t(26288),b=t(18295),f=t(80401),v=t(59462),j=t(45103),w=t(29695),y=t(89850),E=t(48052);let I=()=>{let{blogId:e}=(0,l.useParams)(),[r,t]=(0,a.useState)(null),[I,N]=(0,a.useState)([]),[P,$]=(0,a.useState)(),[C,q]=(0,a.useState)(""),[A,R]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),{toast:_}=(0,p.dj)(),B=(0,l.useRouter)(),M=(0,i.mN)({resolver:(0,n.u)(E.Em),defaultValues:{title:"",blogId:"",content:"",tags:[]}});if((0,a.useEffect)(()=>{(0,w.Dm)(e).then(e=>{if("error"in e){console.error(e.error);return}t(e),M.reset({title:e.title,content:e.contentOriginal,tags:e.tags,blogId:e.blogId})}),(0,y.rF)(e).then(e=>{if("error"in e){console.log(e.error);return}N(e.filter(e=>!1==e.isThumbnail).map(e=>({alt:e.imageId,src:e.src,file:null}))),$(e.filter(e=>!0==e.isThumbnail).map(e=>({alt:e.imageId,src:e.src,file:null}))[0])})},[]),!r)return(0,s.jsx)("div",{children:"Loading blog..."});let G=async e=>{if(!e.startsWith("blob")){console.log("Deleting image:",e);let r=I.filter(r=>r.src===e);console.log("Deleting image:",r),await (0,y.vS)(r[0].alt)}N(r=>{let t=r.filter(r=>r.src!==e);return URL.revokeObjectURL(e),t})},W=async(e,r)=>{I.filter(r=>r.alt===e)[0].alt===e&&await (0,y.Sq)({imageId:e,newId:r}),N(t=>t.map(t=>t.alt===e?{...t,alt:r}:t))},D=async()=>{P&&!P.src.startsWith("blob")&&await (0,y.vS)(P.alt),$(void 0)},O=async(e,r)=>{P.src.startsWith("blob")||await (0,y.Sq)({imageId:e,newId:r}),$(e=>({...e,alt:r}))},U=async r=>{try{if(R(!0),0===I.length){_({title:"Error",description:"Please upload at least one image",variant:"destructive"}),R(!1);return}if(!P){_({title:"Error",description:"Please upload a thumbnail",variant:"destructive"}),R(!1);return}let t=I.filter(e=>e.src.startsWith("blob")),s=(await Promise.all(I.map(async e=>{try{if(!e.src.startsWith("blob"))return{alt:e.alt,src:e.src};{let r=await (0,v.cV)(e.file);if("string"==typeof r)return t.forEach(t=>{e.alt===t.alt&&(t.src=r)}),{alt:e.alt,src:r};return console.log("Error uploading image:",e.alt),_({title:"Error",description:`Error uploading image ${e.alt}`,variant:"destructive"}),R(!1),null}}catch(e){return console.log("Error saving image:",e),_({title:"Error",description:"Error saving image",variant:"destructive"}),null}}))).filter(e=>null!==e);if(s.length!==I.length){_({title:"Error",description:"Failed to upload all images",variant:"destructive"}),R(!1);return}let a=P.src.startsWith("blob")?P:null;if(a){let e=await (0,v.cV)(a.file);if("string"==typeof e)$({src:e,alt:P.alt,file:P.file}),a.src=e;else{console.log("Error uploading thumbnail:",P.alt),_({title:"Error",description:`Error uploading thumbnail ${P.alt}`,variant:"destructive"}),R(!1);return}}let l=r.content;l=l.replace(/IMG<([^,]+)(?:,\s*(\d+))?(?:,\s*(\d+))?>/g,(e,r,t,a)=>{let l=s.find(e=>e.alt===r);return l?`IMG<${r},${l.src}${t?`,${t}`:""}${a?`,${a}`:""}>`:(_({title:"Error",description:`Image with alt "${r}" not found`,variant:"destructive"}),e)});let i=(0,v.QH)(l),{title:n,tags:o,content:c}=r;await (0,w.Yb)(e,{title:n,tags:o,content:i,contentOriginal:r.content}).then(e=>{if("error"in e){console.log(e.error),_({title:"Error",description:"Error saving blog",variant:"destructive"}),R(!1);return}_({title:"Success",description:"Blog saved successfully",variant:"default"})}).then(async()=>{t.forEach(async r=>{await (0,y.i7)(e,{imageId:r.alt,src:r.src,isThumbnail:!1}).then(e=>{if("error"in e){console.log(e.error),_({title:"Error",description:"Error saving image",variant:"destructive"}),R(!1);return}})}),a&&await (0,y.i7)(e,{imageId:a.alt,src:a.src,isThumbnail:!0}).then(e=>{if("error"in e){console.log(e.error),_({title:"Error",description:"Error saving thumbnail",variant:"destructive"}),R(!1);return}})}).finally(()=>{R(!1),B.push("/admin/blogs")})}catch(e){console.log("Error saving blog:",e),_({title:"Error",description:"Error saving blog",variant:"destructive"})}};return(0,s.jsx)("div",{className:"w-full ",children:(0,s.jsxs)(h.lV,{...M,children:[(0,s.jsx)("form",{onSubmit:M.handleSubmit(U),className:"space-y-8 p-4",children:(0,s.jsxs)("div",{className:"flex space-x-10",children:[(0,s.jsxs)("div",{className:"w-3/4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)(h.zB,{control:M.control,name:"title",render:({field:e})=>(0,s.jsxs)(h.eI,{className:"flex-1",children:[(0,s.jsx)(h.lR,{children:"Blog Name"}),(0,s.jsx)(h.MJ,{children:(0,s.jsx)(m.p,{placeholder:"Enter blog name",...e,disabled:!k})}),(0,s.jsx)(h.C5,{})]})}),(0,s.jsx)(h.zB,{control:M.control,name:"blogId",render:({field:e})=>(0,s.jsxs)(h.eI,{className:"flex-1",children:[(0,s.jsx)(h.lR,{children:"Blog ID"}),(0,s.jsx)(h.MJ,{children:(0,s.jsx)(m.p,{placeholder:"Enter blog ID",...e,disabled:!0})}),(0,s.jsx)(h.C5,{})]})})]}),(0,s.jsx)(h.zB,{control:M.control,name:"content",render:({field:e})=>(0,s.jsxs)(h.eI,{children:[(0,s.jsxs)(h.lR,{className:"w-full flex justify-between items-center",children:[(0,s.jsx)("p",{children:"Content"}),(0,s.jsxs)(d.lG,{children:[(0,s.jsx)(d.zM,{children:(0,s.jsx)("p",{className:"hover:underline",children:"Help"})}),(0,s.jsxs)(d.Cf,{className:"max-w-4xl max-h-[80vh]",children:[(0,s.jsx)(d.c7,{children:(0,s.jsx)(d.L3,{children:"Blog Content Guideline"})}),(0,s.jsx)(j.default,{src:"/images/guidline.png",alt:"guidline",width:800,height:600})]})]})]}),(0,s.jsx)(h.MJ,{children:(0,s.jsx)(c.T,{placeholder:"Write your blog content here...",className:"min-h-[300px]",...e,disabled:!k})}),(0,s.jsx)(h.C5,{})]})})]}),(0,s.jsxs)("div",{className:"w-1/4 space-y-4",children:[(0,s.jsx)("p",{className:"text-lg font-bold",children:"Choose images for content"}),(0,s.jsx)(x.A,{uploadedImages:I,onUpload:e=>{let r=URL.createObjectURL(e),t=e.name.split(".").slice(0,-1).join(".");N(s=>[...s,{alt:t,src:r,file:e}])},onDelete:G,onUpdateAlt:W,isEditing:k}),(0,s.jsxs)(d.lG,{children:[(0,s.jsx)(d.zM,{asChild:!0,children:(0,s.jsx)(o.$,{onClick:()=>{let e=M.getValues("content");e=e.replace(/IMG<([^,]+)(?:,\s*(\d+))?(?:,\s*(\d+))?>/g,(e,r,t,s)=>{let a=I.find(e=>e.alt===r);return a?`IMG<${r},${a.src}${t?`,${t}`:""}${s?`,${s}`:""}>`:(_({title:"Error",description:`Image with alt "${r}" not found`,variant:"destructive"}),e)}),q((0,v.QH)(e))},className:"w-full",children:"Preview"})}),(0,s.jsxs)(d.Cf,{className:"max-w-4xl max-h-[80vh]",children:[(0,s.jsx)(d.c7,{children:(0,s.jsx)(d.L3,{children:"Blog Preview"})}),(0,s.jsx)(u.F,{className:"h-full max-h-[calc(80vh-4rem)]",children:(0,s.jsx)(b.A,{content:C})})]})]}),(0,s.jsx)("p",{className:"text-lg font-bold",children:"Choose thumbnail"}),(0,s.jsx)(x.A,{uploadedImages:P?[P]:[],onUpload:e=>{let r=URL.createObjectURL(e);$({alt:e.name.split(".").slice(0,-1).join("."),src:r,file:e})},onDelete:D,onUpdateAlt:O,isMultiple:!1,isEditing:k}),(0,s.jsx)(h.zB,{control:M.control,name:"tags",render:({field:e})=>(0,s.jsxs)(h.eI,{children:[(0,s.jsx)(h.lR,{children:"Tags"}),(0,s.jsx)(h.MJ,{children:(0,s.jsx)(f.A,{tags:e.value,setTags:e.onChange,isEditing:k})}),(0,s.jsx)(h.C5,{})]})}),k?(0,s.jsxs)("div",{className:"flex justify-start items-start space-x-4 w-fit",children:[(0,s.jsx)(o.$,{type:"submit",className:`${A?"bg-[#030391]/20 cursor-not-allowed hover:bg-[#030391]/20 active:bg-[#030391]/20":"bg-sub hover:bg-main/90 active:bg-main/95"} w-full relative`,children:A?(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-gray-900"})}):"Save changes"}),!A&&(0,s.jsxs)(o.$,{onClick:e=>{e.preventDefault(),S(!1)},children:["Cancel"," "]})]}):(0,s.jsx)(o.$,{onClick:e=>{e.preventDefault(),S(!0)},children:"Edit Blog"})]})]})}),(0,s.jsx)(g.Toaster,{})]})})}},29695:(e,r,t)=>{"use strict";t.d(r,{Dm:()=>l,Xm:()=>a,Yb:()=>n,ly:()=>i,yb:()=>o});var s=t(79828);let a=async()=>{try{let e=await s.A.get("api/blog/routes.php");return console.log("Backend Response:",e.data),e.data.data.map(e=>({blogId:e.blogId,title:e.title,content:e.content,tags:JSON.parse(e.tags),posted:e.posted,contentOriginal:e.content_original}))}catch(e){return console.log("Error:",e),{error:"An error occurred while fetching blogs"}}},l=async e=>{try{let r=await s.A.get(`api/blog/routes.php?blogId=${e}`);console.log("Backend Response:",r.data);let{title:t,content:a,tags:l,posted:i,content_original:n}=r.data.data;return{blogId:e,title:t,content:a,tags:JSON.parse(l),posted:i,contentOriginal:n}}catch(e){return console.log("Error:",e),{error:"An error occurred while fetching blog"}}},i=async e=>{try{let r=await s.A.post("api/blog/routes.php",e);return console.log("Backend Response:",r.data),{message:r.data.message}}catch(e){return console.log("Error:",e),{error:"An error occurred while creating blog"}}},n=async(e,r)=>{try{let t=await s.A.put(`api/blog/routes.php?blogId=${e}`,r);return console.log("Backend Response:",t.data),{message:t.data.message}}catch(e){return console.log("Error:",e),{error:"An error occurred while updating blog"}}},o=async e=>{try{let r=await s.A.delete(`api/blog/routes.php?blogId=${e}`);return console.log("Backend Response:",r.data),{message:r.data.message}}catch(e){return console.log("Error:",e),{error:"An error occurred while deleting blog"}}}},52603:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"W:\\\\web\\\\shop-co3049-fe\\\\app\\\\admin\\\\(main)\\\\blogs\\\\[blogId]\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"W:\\web\\shop-co3049-fe\\app\\admin\\(main)\\blogs\\[blogId]\\page.tsx","default")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,9798,7180,4388,5103,9749,8310,6371,3998,6107,72,2130],()=>t(18309));module.exports=s})();